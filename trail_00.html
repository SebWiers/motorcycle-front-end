<!DOCTYPE html>
<html><head><meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
<title>MFE wheelbase & trail calculator 0.1</title>
<style type='text/css'>
body {	
	background-color: #eee;
	color: #333;
	padding: 20px;
}
input class="number".number { 
	text-align: right; 
}
canvas{
	background-color: #fff;
	/* transform: scale(1, -1); flip vertical for 0,0 in bottom left?*/
}
button{margin:20px}
</style>
</head>


<body>

<div id='diagramCanvasDiv'><canvas id='diagramCanvas' width='1000' height='618'></canvas></div>
<button onclick='reDrawButton()'>Redraw</button>
<div id='forkData' style='width: 1000px;' title="input class="number" units are arbitrary; results can be read in same units">
<table style='float: left'>
<tr><th colspan="2">Measured Setup</th></tr>
<tr><td>Front Wheel Outside Diameter</td><td> <input class="number" id='FWOD' type='number' style='width:99%' value='22'> </td></tr>
<tr><td>Rear Wheel Outside Diameter</td><td> <input class="number" id='RWOD' type='number' style='width:99%' value='22'> </td></tr>
<tr title="degrees back from vertical"><td>Neck Rake</td><td> <input class="number" id='FNR' type='number' style='width:99%' value='30'></td></tr>
<tr title="axle to neck bottom, parallel with neck or tree rake"><td>Fork Length</td><td> <input class="number" id='FL' type='number' style='width:99%' value='15'> </td></tr>
<tr title="measure parallel to ground"><td>Rear Axle to Neck Bottom</td><td> <input class="number" id='RANB' type='number' style='width:99%' value='45.8'> </td></tr>
<tr title="leg ahead of steerer, perpendicular to neck rake"><td>Tree Offset</td><td> <input class="number" id='FTO' type='number' style='width:99%' value='1'> </td></tr>
<tr title="axle ahead fork legs, perpendicular to neck rake"><td>Axle Offset</td><td> <input class="number" id='FAO' type='number' style='width:99%' value='1'> </td></tr>
<tr title="degrees forward from neck"><td>Raked Tree</td><td> <input class="number" id='FTR' type='number' style='width:99%' value='0'> </td></tr>
<tr><td>Fork Slider Travel</td><td> <input class="number" id='FST' type='number' style='width:99%' value='' disabled> </td></tr>

</table>

<table style='float: right'>
<tbody>
<tr><td>Ground to Neck Bottom</td><td> <input class="number" id='GNB' style='width:99%' value='' disabled> </td></tr>
<tr><td>Trail</td><td> <input class="number" id='TRAIL' style='width:99%' value='' disabled> </td></tr>
<tr><td>Wheelbase</td><td> <input class="number" id='WB' style='width:99%' value='' disabled> </td></tr>
</tbody>
</table>
</div>

<script type='text/javascript'>
//helper functions
function getLegPythag(hyp, leg){
	var diffSquare = Math.pow(hyp,2) - Math.pow(leg,2);
	return Math.pow(diffSquare,0.5);
};
function getHypPythag(a,b){
	var sumSquare = Math.pow(a,2) + Math.pow(b,2);
	return Math.pow(sumSquare,0.5);
};
function precisionRound(number, precision) {
  var factor = Math.pow(10, precision);
  return Math.round(number * factor) / factor;
};
//diagram dimensions
function getBikeDiagramDims(){
	var groundY = parseFloat( document.getElementById('diagramCanvas').height);
	var maxWheelbase = parseFloat(document.getElementById('RANB').value) + parseFloat(document.getElementById('FL').value)
	var maxLength = parseFloat(document.getElementById('FWOD').value)/2 + parseFloat(document.getElementById('RWOD').value)/2 + maxWheelbase
	var scale = parseFloat(diagram.width) / maxLength;
	var axleCrown = getHypPythag(parseFloat(document.getElementById('FL').value) * scale, parseFloat(document.getElementById('FTO').value) * scale + parseFloat(document.getElementById('FAO').value) * scale)
	var bikeDraw = 
	{
		height: document.getElementById('diagramCanvas').height,
		width: document.getElementById('diagramCanvas').width,
		scale: scale,
		wheelbase: NaN,
		frontTire:{ 
			radius : parseFloat(document.getElementById('FWOD').value)/2 * scale,
			groundX : parseFloat(document.getElementById('FWOD').value)/2 * scale, 
			groundY : groundY - parseFloat(document.getElementById('FWOD').value)/2 * scale
		},
		rearTire:{ 
			radius : parseFloat(document.getElementById('RWOD').value)/2 * scale,
			groundX : NaN, 
			groundY : groundY - parseFloat(document.getElementById('RWOD').value)/2 * scale
		},
		fork:{
			length: parseFloat(document.getElementById('FL').value) * scale,
			travel: parseFloat(document.getElementById('FST').value) * scale || 0,
			treeOffset: parseFloat(document.getElementById('FTO').value) * scale || 0,
			treeRake: parseFloat(document.getElementById('FTR').value) * Math.PI/-180 || 0,
			axleOffset: parseFloat(document.getElementById('FAO').value) * scale || 0,
			axleCrown: axleCrown,
			axleToGroundX: parseFloat(document.getElementById('FWOD').value)/2 * scale, 
			axleToGroundY: groundY - parseFloat(document.getElementById('FWOD').value)/2 * scale,
			neckRakeRad: (90-parseFloat(document.getElementById('FNR').value)) * Math.PI/180,
		}
	};
	return bikeDraw;
};
//drawing functions
function drawTire(ctx,tire,x,y){
	//x and y optional, overide tire defaults
  if (!x){x = tire.groundX};
  if (!y){y = tire.groundY};
  ctx.lineWidth = 3;
  ctx.beginPath(); ctx.arc(x, y, tire.radius, 0 , Math.PI*2);
  ctx.strokeStyle = '#333'; ctx.stroke();
  ctx.fillStyle = '#999'; ctx.fill();
  ctx.fillStyle = '#000'; ctx.fillRect(x-2, y-2, 5, 5);
};
function newDrawFork(ctx,bike){
	// find leg top and bottom
	bike.fork.legBottomX = bike.frontTire.groundX + bike.fork.axleOffset * Math.sin(bike.fork.neckRakeRad);
	bike.fork.legBottomY = bike.frontTire.groundY + bike.fork.axleOffset * Math.cos(bike.fork.neckRakeRad);
	bike.fork.legTopX = bike.fork.legBottomX + bike.fork.length * Math.cos(bike.fork.neckRakeRad + bike.fork.treeRake);
	bike.fork.legTopY = bike.fork.legBottomY - bike.fork.length * Math.sin(bike.fork.neckRakeRad + bike.fork.treeRake);
	// find neck bottom via rake
	bike.fork.neckBottomX = bike.frontTire.groundX + (bike.fork.treeOffset + bike.fork.axleOffset) * Math.sin(bike.fork.neckRakeRad) + bike.fork.length * Math.cos(bike.fork.neckRakeRad + bike.fork.treeRake);
	bike.fork.neckBottomY = bike.frontTire.groundY + (bike.fork.treeOffset + bike.fork.axleOffset) * Math.cos(bike.fork.neckRakeRad) - bike.fork.length * Math.sin(bike.fork.neckRakeRad + bike.fork.treeRake);
	
	//draw neck bottom dots
	ctx.fillStyle = '#000'; ctx.fillRect(bike.fork.neckBottomX-2, bike.fork.neckBottomY-2, 5, 5);	
	bike.fork.neckBottomHeight = bike.height - bike.fork.neckBottomY;
	document.getElementById('GNB').value = precisionRound(bike.fork.neckBottomHeight/bike.scale, 1).toFixed(1);
	//define and display wheelbase
	bike.rearTire.groundX = parseFloat(document.getElementById('RANB').value) * bike.scale + bike.fork.neckBottomX
	bike.wheelbase = bike.rearTire.groundX - bike.frontTire.groundX;
	document.getElementById('WB').value = precisionRound(bike.wheelbase/bike.scale, 1).toFixed(1);
	
	// find & draw rake line, calculate and show trail
	bike.fork.rakeLineGroundX = bike.fork.neckBottomX - Math.tan(Math.PI/2-bike.fork.neckRakeRad) * bike.fork.neckBottomHeight
	bike.fork.rakeLineGroundY = bike.height;
	//ctx.fillRect(bike.fork.rakeLineGroundX-2, bike.fork.rakeLineGroundY-2, 5, 5);
	ctx.beginPath(); ctx.lineWidth = 1;  ctx.strokeStyle = '#f99'
	ctx.moveTo(bike.fork.neckBottomX, bike.fork.neckBottomY); ctx.lineTo(bike.fork.rakeLineGroundX, bike.fork.rakeLineGroundY); ctx.stroke();
	bike.fork.trail = bike.frontTire.groundX - bike.fork.rakeLineGroundX;
	document.getElementById('TRAIL').value = precisionRound(bike.fork.trail/bike.scale, 1).toFixed(1);
	
	//draw fork leg
	ctx.beginPath(); ctx.lineWidth = 7;  ctx.strokeStyle = '#B33'
	ctx.moveTo(bike.fork.legTopX, bike.fork.legTopY); ctx.lineTo(bike.fork.legBottomX, bike.fork.legBottomY); ctx.stroke();
	//draw lower tree / leg offset
	ctx.beginPath(); ctx.lineWidth = 7;  ctx.strokeStyle = '#833'
	ctx.moveTo(bike.fork.legTopX, bike.fork.legTopY); ctx.lineTo(bike.fork.neckBottomX, bike.fork.neckBottomY); //ctx.stroke();
	ctx.moveTo(bike.fork.legBottomX, bike.fork.legBottomY); ctx.lineTo(bike.frontTire.groundX, bike.frontTire.groundY); ctx.stroke();
}
function newDraw(ctx,bike){
	ctx.clearRect(0, 0, diagram.width, diagram.height);
	drawTire(ctx, bike.frontTire);
	newDrawFork(ctx, bike);
	drawTire(ctx, bike.rearTire);
};
function reDrawButton(){
	newDraw(dc,getBikeDiagramDims()); 
};
//page load draw
var diagram = document.getElementById('diagramCanvas');
var dc = diagram.getContext('2d');
newDraw(dc,getBikeDiagramDims());
</script>
</body>
</html>